-- 1. Create the database
-- This matches the 'mybook_db' name used in your db.php file.
CREATE DATABASE IF NOT EXISTS mybook_db;
USE mybook_db;

-- 2. USERS Table: Stores account information
-- Essential for login and registration.
CREATE TABLE IF NOT EXISTS users (
    id INT(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL, -- Stores the secure password hash
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 3. POSTS Table: Stores all user-generated content for the timeline
-- Essential for your index.php and post.php files.
CREATE TABLE IF NOT EXISTS posts (
    id INT(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    user_id INT(11) NOT NULL,
    post_content TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    -- Links the post back to the user who wrote it
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 4. FRIENDSHIPS Table: Manages social connections (requests, accepted friends)
-- Essential for your send_request.php, requests.php, and filtered index.php feed.
CREATE TABLE IF NOT EXISTS friendships (
    id INT(11) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    user1_id INT(11) NOT NULL,
    user2_id INT(11) NOT NULL,
    status ENUM('pending', 'accepted') NOT NULL DEFAULT 'pending',
    
    -- Ensures a friendship is only recorded once
    UNIQUE KEY unique_friendship (user1_id, user2_id),
    
    FOREIGN KEY (user1_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (user2_id) REFERENCES users(id) ON DELETE CASCADE
);